<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mentora Admin - ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</title>
    <link rel="icon" type="image/png" href="../images/logo-brain-hd.png">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;900&family=Poppins:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', 'Poppins', sans-serif;
            background: #f8f9fa;
            display: flex;
            min-height: 100vh;
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            width: 260px;
            background: linear-gradient(180deg, #2c5f4f 0%, #1a4838 100%);
            color: white;
            padding: 2rem 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .sidebar-header {
            padding: 0 2rem 2rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 2rem;
        }

        .sidebar-header h2 {
            font-size: 1.8rem;
            font-weight: 900;
            color: #d4af37;
        }

        .sidebar-header p {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 0.5rem;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 0.5rem;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 1rem 2rem;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background: rgba(212, 175, 55, 0.2);
            border-right: 4px solid #d4af37;
        }

        .sidebar-menu a i {
            margin-right: 1rem;
            font-size: 1.2rem;
        }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 2rem;
        }

        .topbar {
            background: white;
            border-radius: 12px;
            padding: 1.5rem 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .topbar h1 {
            font-size: 1.8rem;
            color: #2c5f4f;
            font-weight: 700;
        }

        .topbar-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #2c5f4f;
            color: white;
        }

        .btn-primary:hover {
            background: #1a4838;
            transform: translateY(-2px);
        }

        .btn-outline {
            background: white;
            color: #2c5f4f;
            border: 2px solid #2c5f4f;
        }

        .btn-outline:hover {
            background: #2c5f4f;
            color: white;
        }

        /* í†µê³„ ì¹´ë“œ ê·¸ë¦¬ë“œ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .stat-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .stat-card-title {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }

        .stat-card-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-card-value {
            font-size: 2.5rem;
            font-weight: 900;
            color: #2c5f4f;
            margin-bottom: 0.5rem;
        }

        .stat-card-change {
            font-size: 0.9rem;
            color: #28a745;
        }

        .stat-card-change.negative {
            color: #dc3545;
        }

        /* ì°¨íŠ¸ ê·¸ë¦¬ë“œ */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .chart-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .chart-card h3 {
            font-size: 1.2rem;
            color: #2c5f4f;
            margin-bottom: 1.5rem;
            font-weight: 700;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* í™œë™ ì¹´ë“œ */
        .activity-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .activity-card h3 {
            font-size: 1.2rem;
            color: #2c5f4f;
            margin-bottom: 1.5rem;
            font-weight: 700;
        }

        .activity-list {
            list-style: none;
        }

        .activity-item {
            padding: 1.5rem;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-item:hover {
            background: #f8f9fa;
            padding-left: 2rem;
        }

        .activity-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .activity-text h4 {
            font-size: 1rem;
            color: #333;
            margin-bottom: 0.25rem;
        }

        .activity-text p {
            font-size: 0.85rem;
            color: #999;
        }

        .activity-time {
            font-size: 0.85rem;
            color: #999;
        }

        /* ê°€ì´ë“œë¶ íŒë§¤ ì„¹ì…˜ */
        #guidebook-section {
            margin-top: 3rem;
            padding-top: 3rem;
            border-top: 2px solid #e0e0e0;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .section-header h2 {
            font-size: 1.8rem;
            color: #2c5f4f;
            font-weight: 900;
        }

        .section-header p {
            color: #666;
            margin-top: 0.5rem;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .sidebar {
                width: 0;
                padding: 0;
                overflow: hidden;
            }

            .main-content {
                margin-left: 0;
                padding: 1rem;
            }

            .topbar {
                flex-direction: column;
                gap: 1rem;
            }

            .stats-grid,
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ì‚¬ì´ë“œë°” -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>ğŸ§  Mentora</h2>
            <p>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</p>
        </div>

        <ul class="sidebar-menu">
            <li><a href="#dashboard" class="active"><i class="fas fa-chart-line"></i> ëŒ€ì‹œë³´ë“œ</a></li>
            <li><a href="users.html"><i class="fas fa-users"></i> ì‚¬ìš©ì ê´€ë¦¬</a></li>
            <li><a href="tests.html"><i class="fas fa-clipboard-check"></i> ê²€ì‚¬ ê´€ë¦¬</a></li>
            <li><a href="premium.html"><i class="fas fa-crown"></i> í”„ë¦¬ë¯¸ì—„</a></li>
            <li><a href="#guidebook-section"><i class="fas fa-book"></i> ê°€ì´ë“œë¶ íŒë§¤</a></li>
            <li><a href="refunds.html"><i class="fas fa-undo"></i> í™˜ë¶ˆ ê´€ë¦¬</a></li>
            <li><a href="settings.html"><i class="fas fa-cog"></i> ì„¤ì •</a></li>
            <li><a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> ë¡œê·¸ì•„ì›ƒ</a></li>
        </ul>
    </aside>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="main-content">
        <!-- ìƒë‹¨ë°” -->
        <div class="topbar">
            <div>
                <h1>ëŒ€ì‹œë³´ë“œ</h1>
                <p style="color: #999; margin-top: 0.5rem;">ì „ì²´ ì‹œìŠ¤í…œ í˜„í™©ì„ í™•ì¸í•˜ì„¸ìš”</p>
            </div>
            <div class="topbar-actions">
                <button class="btn btn-outline">ğŸ“Š ë¦¬í¬íŠ¸ ìƒì„±</button>
                <a href="../index.html" class="btn btn-primary">ğŸŒ ì‚¬ì´íŠ¸ ë³´ê¸°</a>
            </div>
        </div>

        <!-- í†µê³„ ì¹´ë“œ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-card-header">
                    <span class="stat-card-title">ì „ì²´ ì‚¬ìš©ì</span>
                    <div class="stat-card-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
                <div class="stat-card-value">1,250</div>
                <div class="stat-card-change">
                    <i class="fas fa-arrow-up"></i> +12.5% ì§€ë‚œì£¼ ëŒ€ë¹„
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-card-header">
                    <span class="stat-card-title">ì™„ë£Œëœ ê²€ì‚¬</span>
                    <div class="stat-card-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
                        <i class="fas fa-clipboard-check"></i>
                    </div>
                </div>
                <div class="stat-card-value">8,542</div>
                <div class="stat-card-change">
                    <i class="fas fa-arrow-up"></i> +8.3% ì§€ë‚œì£¼ ëŒ€ë¹„
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-card-header">
                    <span class="stat-card-title">ì´ ë§¤ì¶œ</span>
                    <div class="stat-card-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white;">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                </div>
                <div class="stat-card-value">â‚©2.5M</div>
                <div class="stat-card-change">
                    <i class="fas fa-arrow-up"></i> +15.2% ì§€ë‚œì£¼ ëŒ€ë¹„
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-card-header">
                    <span class="stat-card-title">í™˜ë¶ˆ ëŒ€ê¸°</span>
                    <div class="stat-card-icon" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white;">
                        <i class="fas fa-undo"></i>
                    </div>
                </div>
                <div class="stat-card-value">12</div>
                <div class="stat-card-change negative">
                    <i class="fas fa-arrow-down"></i> -3 ê±´ (ì²˜ë¦¬ í•„ìš”)
                </div>
            </div>
        </div>

        <!-- ì°¨íŠ¸ ê·¸ë¦¬ë“œ -->
        <div class="charts-grid">
            <div class="chart-card">
                <h3>ğŸ“ˆ ê²€ì‚¬ ì™„ë£Œ ì¶”ì´ (ìµœê·¼ 7ì¼)</h3>
                <div class="chart-container">
                    <canvas id="testChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h3>ğŸ”¥ ì¸ê¸° ê²€ì‚¬ TOP 5</h3>
                <div class="chart-container">
                    <canvas id="popularChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ìµœê·¼ í™œë™ -->
        <div class="activity-card">
            <h3>ğŸ• ìµœê·¼ í™œë™</h3>
            <ul class="activity-list">
                <li class="activity-item">
                    <div class="activity-info">
                        <div class="activity-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <div class="activity-text">
                            <h4>ê¹€ë¯¼ì§€ë‹˜ì´ íšŒì›ê°€ì…í–ˆìŠµë‹ˆë‹¤</h4>
                            <p>ìƒˆë¡œìš´ ì‚¬ìš©ì</p>
                        </div>
                    </div>
                    <span class="activity-time">5ë¶„ ì „</span>
                </li>

                <li class="activity-item">
                    <div class="activity-info">
                        <div class="activity-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="activity-text">
                            <h4>ì´ì¤€í˜¸ë‹˜ì´ MBTI ê²€ì‚¬ë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤</h4>
                            <p>ê²€ì‚¬ ê²°ê³¼: INFP</p>
                        </div>
                    </div>
                    <span class="activity-time">12ë¶„ ì „</span>
                </li>

                <li class="activity-item">
                    <div class="activity-info">
                        <div class="activity-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white;">
                            <i class="fas fa-crown"></i>
                        </div>
                        <div class="activity-text">
                            <h4>ë°•ì„œì—°ë‹˜ì´ í”„ë¦¬ë¯¸ì—„ í”Œëœì„ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤</h4>
                            <p>ì›”ê°„ êµ¬ë… â‚©9,900</p>
                        </div>
                    </div>
                    <span class="activity-time">23ë¶„ ì „</span>
                </li>

                <li class="activity-item">
                    <div class="activity-info">
                        <div class="activity-icon" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white;">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                        <div class="activity-text">
                            <h4>ìµœì§€ìš°ë‹˜ì´ í™˜ë¶ˆì„ ìš”ì²­í–ˆìŠµë‹ˆë‹¤</h4>
                            <p>ì²˜ë¦¬ í•„ìš”</p>
                        </div>
                    </div>
                    <span class="activity-time">1ì‹œê°„ ì „</span>
                </li>
            </ul>
        </div>

        <!-- ê°€ì´ë“œë¶ íŒë§¤ ì„¹ì…˜ -->
        <section id="guidebook-section">
            <div class="section-header">
                <div>
                    <h2>ğŸ“š ê°€ì´ë“œë¶ íŒë§¤ í˜„í™©</h2>
                    <p>PDF ê°€ì´ë“œë¶ íŒë§¤ í†µê³„ ë° ë§¤ì¶œ í˜„í™©</p>
                </div>
                <button class="btn btn-primary" onclick="location.reload()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            </div>

            <!-- ê°€ì´ë“œë¶ í†µê³„ ì¹´ë“œ -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-header">
                        <span class="stat-card-title">ì´ íŒë§¤ ê±´ìˆ˜</span>
                        <div class="stat-card-icon" style="background: linear-gradient(135deg, #d4af37 0%, #f2c94c 100%); color: white;">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                    </div>
                    <div class="stat-card-value" id="guidebook_sales">0</div>
                    <div class="stat-card-change">
                        <i class="fas fa-book"></i> ê°€ì´ë“œë¶ íŒë§¤
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-card-header">
                        <span class="stat-card-title">ì´ ë§¤ì¶œ</span>
                        <div class="stat-card-icon" style="background: linear-gradient(135deg, #2c5f4f 0%, #1a4838 100%); color: white;">
                            <i class="fas fa-won-sign"></i>
                        </div>
                    </div>
                    <div class="stat-card-value" id="guidebookRevenue">â‚©0</div>
                    <div class="stat-card-change">
                        <i class="fas fa-arrow-up"></i> ê°€ì´ë“œë¶ ë§¤ì¶œ
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-card-header">
                        <span class="stat-card-title">ì¸ê¸° ê°€ì´ë“œë¶</span>
                        <div class="stat-card-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                            <i class="fas fa-star"></i>
                        </div>
                    </div>
                    <div class="stat-card-value" id="topGuidebook" style="font-size: 1.8rem;">-</div>
                    <div class="stat-card-change">
                        <i class="fas fa-fire"></i> ê°€ì¥ ë§ì´ íŒë§¤ëœ ìƒí’ˆ
                    </div>
                </div>
            </div>

            <!-- ê°€ì´ë“œë¶ ì°¨íŠ¸ -->
            <div class="charts-grid">
                <div class="chart-card">
                    <h3>ğŸ“Š ê°€ì´ë“œë¶ íŒë§¤ ì¶”ì´ (ìµœê·¼ 7ì¼)</h3>
                    <div class="chart-container">
                        <canvas id="guidebookSalesChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h3>ğŸ† ì¸ê¸° ê°€ì´ë“œë¶ TOP 5</h3>
                    <div class="chart-container">
                        <canvas id="guidebookTopChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- ìµœê·¼ êµ¬ë§¤ ë‚´ì—­ -->
            <div class="activity-card">
                <h3>ğŸ“¦ ìµœê·¼ ê°€ì´ë“œë¶ êµ¬ë§¤ ë‚´ì—­ (ìµœê·¼ 10ê±´)</h3>
                <div id="guidebookOrdersList" style="margin-top: 1.5rem;">
                    <p style="text-align: center; color: #999; padding: 2rem;">
                        <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 1rem; display: block;"></i>
                        êµ¬ë§¤ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤
                    </p>
                </div>
            </div>
        </section>
    </main>

    <script>
        // ë¡œê·¸ì¸ í™•ì¸
        const isLoggedIn = localStorage.getItem('adminAuth');
        if (!isLoggedIn) {
            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            window.location.href = 'login.html';
        }

        // ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
        function logout() {
            localStorage.removeItem('adminAuth');
            alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
            window.location.href = 'login.html';
        }

        // ê°€ì´ë“œë¶ ë°ì´í„° ë¡œë“œ
        function loadGuidebookData() {
            const purchases = JSON.parse(localStorage.getItem('guidebook_purchases') || '[]');
            
            if (purchases.length === 0) {
                document.getElementById('guidebook_sales').textContent = '0';
                document.getElementById('guidebookRevenue').textContent = 'â‚©0';
                document.getElementById('topGuidebook').textContent = '-';
                return;
            }

            // ì´ íŒë§¤ ê±´ìˆ˜
            document.getElementById('guidebook_sales').textContent = purchases.length;

            // ì´ ë§¤ì¶œ
            const totalRevenue = purchases.reduce((sum, p) => sum + p.amount, 0);
            document.getElementById('guidebookRevenue').textContent = `â‚©${totalRevenue.toLocaleString()}`;

            // ìƒí’ˆë³„ íŒë§¤ ê±´ìˆ˜ ê³„ì‚°
            const productCount = {};
            purchases.forEach(p => {
                const name = p.productName;
                productCount[name] = (productCount[name] || 0) + 1;
            });

            // ì¸ê¸° ê°€ì´ë“œë¶
            const topProduct = Object.entries(productCount)
                .sort((a, b) => b[1] - a[1])[0];
            document.getElementById('topGuidebook').textContent = topProduct[0];

            // ìµœê·¼ 10ê±´ êµ¬ë§¤ ë‚´ì—­ í‘œì‹œ
            const recent = purchases.slice(-10).reverse();
            document.getElementById('guidebookOrdersList').innerHTML = `
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="border-bottom: 2px solid #e0e0e0;">
                            <th style="padding: 1rem; text-align: left; color: #666;">ì£¼ë¬¸ë²ˆí˜¸</th>
                            <th style="padding: 1rem; text-align: left; color: #666;">ìƒí’ˆëª…</th>
                            <th style="padding: 1rem; text-align: left; color: #666;">êµ¬ë§¤ì</th>
                            <th style="padding: 1rem; text-align: right; color: #666;">ê¸ˆì•¡</th>
                            <th style="padding: 1rem; text-align: center; color: #666;">êµ¬ë§¤ì¼</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${recent.map(order => `
                            <tr style="border-bottom: 1px solid #f0f0f0;">
                                <td style="padding: 1rem; font-size: 0.9rem; color: #999;">${order.orderId.substring(0, 20)}...</td>
                                <td style="padding: 1rem; font-weight: 600; color: #2c5f4f;">ğŸ“˜ ${order.productName}</td>
                                <td style="padding: 1rem;">${order.customerName}</td>
                                <td style="padding: 1rem; text-align: right; font-weight: 700; color: #d4af37;">â‚©${order.amount.toLocaleString()}</td>
                                <td style="padding: 1rem; text-align: center; font-size: 0.9rem;">${new Date(order.paymentDate).toLocaleDateString('ko-KR')}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
            drawGuidebookCharts(purchases, productCount);
        }

        // ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ì €ì¥ ë³€ìˆ˜
        let guidebookSalesChartInstance = null;
        let guidebookTopChartInstance = null;

        // ê°€ì´ë“œë¶ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        function drawGuidebookCharts(purchases, productCount) {
            // ê¸°ì¡´ ì°¨íŠ¸ íŒŒê´´
            if (guidebookSalesChartInstance) {
                guidebookSalesChartInstance.destroy();
            }
            if (guidebookTopChartInstance) {
                guidebookTopChartInstance.destroy();
            }

            // ì¼ë³„ íŒë§¤ ì¶”ì´
            const last7Days = [];
            const today = new Date();
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                last7Days.push(date.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' }));
            }
            
            const dailySales = new Array(7).fill(0);
            purchases.forEach(p => {
                const purchaseDate = new Date(p.paymentDate);
                const daysDiff = Math.floor((today - purchaseDate) / (1000 * 60 * 60 * 24));
                if (daysDiff >= 0 && daysDiff < 7) {
                    dailySales[6 - daysDiff]++;
                }
            });
            
            const salesCtx = document.getElementById('guidebookSalesChart').getContext('2d');
            guidebookSalesChartInstance = new Chart(salesCtx, {
                type: 'line',
                data: {
                    labels: last7Days,
                    datasets: [{
                        label: 'íŒë§¤ ê±´ìˆ˜',
                        data: dailySales,
                        borderColor: '#d4af37',
                        backgroundColor: 'rgba(212, 175, 55, 0.1)',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
            
            // ì¸ê¸° ê°€ì´ë“œë¶ TOP 5
            const topProducts = Object.entries(productCount)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            const topCtx = document.getElementById('guidebookTopChart').getContext('2d');
            guidebookTopChartInstance = new Chart(topCtx, {
                type: 'bar',
                data: {
                    labels: topProducts.map(p => p[0]),
                    datasets: [{
                        label: 'íŒë§¤ ê±´ìˆ˜',
                        data: topProducts.map(p => p[1]),
                        backgroundColor: [
                            'rgba(212, 175, 55, 0.8)',
                            'rgba(44, 95, 79, 0.8)',
                            'rgba(103, 126, 234, 0.8)',
                            'rgba(255, 159, 64, 0.8)',
                            'rgba(153, 102, 255, 0.8)'
                        ],
                        borderColor: [
                            '#d4af37',
                            '#2c5f4f',
                            '#667eea',
                            '#ff9f40',
                            '#9966ff'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê°€ì´ë“œë¶ ë°ì´í„° ë¡œë“œ
        document.addEventListener('DOMContentLoaded', () => {
            loadGuidebookData();
        });
    </script>

    <script>
        // Test Trend Chart
        const testCtx = document.getElementById('testChart').getContext('2d');
        new Chart(testCtx, {
            type: 'line',
            data: {
                labels: ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'],
                datasets: [{
                    label: 'ì™„ë£Œëœ ê²€ì‚¬',
                    data: [120, 150, 180, 170, 190, 210, 230],
                    borderColor: '#2c5f4f',
                    backgroundColor: 'rgba(44, 95, 79, 0.1)',
                    tension: 0.4,
                    fill: true,
                    borderWidth: 3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 50
                        }
                    }
                }
            }
        });

        // Popular Tests Chart
        const popularCtx = document.getElementById('popularChart').getContext('2d');
        new Chart(popularCtx, {
            type: 'bar',
            data: {
                labels: ['MBTI', 'Enneagram', 'Big Five', 'EQ', 'DISC'],
                datasets: [{
                    label: 'ì™„ë£Œ ê±´ìˆ˜',
                    data: [3200, 2150, 1800, 1650, 1420],
                    backgroundColor: [
                        'rgba(212, 175, 55, 0.8)',
                        'rgba(44, 95, 79, 0.8)',
                        'rgba(103, 126, 234, 0.8)',
                        'rgba(255, 159, 64, 0.8)',
                        'rgba(153, 102, 255, 0.8)'
                    ],
                    borderColor: [
                        '#d4af37',
                        '#2c5f4f',
                        '#667eea',
                        '#ff9f40',
                        '#9966ff'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 500
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>
