<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>환불 관리 | Mentora Admin</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../images/logo-brain-hd.png">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;900&family=Poppins:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Admin CSS -->
    <link rel="stylesheet" href="css/admin.css">
</head>
<body>
    <!-- Admin Sidebar -->
    <aside class="admin-sidebar">
        <div class="sidebar-header">
            <div class="admin-logo">
                <i class="fas fa-brain"></i>
                <span>Mentora Admin</span>
            </div>
            <button class="sidebar-toggle" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        
        <nav class="sidebar-nav">
            <a href="index.html" class="nav-item">
                <i class="fas fa-chart-line"></i>
                <span>대시보드</span>
            </a>
            <a href="users.html" class="nav-item">
                <i class="fas fa-users"></i>
                <span>사용자 관리</span>
            </a>
            <a href="tests.html" class="nav-item">
                <i class="fas fa-clipboard-list"></i>
                <span>검사 관리</span>
            </a>
            <a href="refunds.html" class="nav-item active">
                <i class="fas fa-receipt"></i>
                <span>환불 관리</span>
                <span class="badge">신규</span>
            </a>
            <a href="settings.html" class="nav-item">
                <i class="fas fa-cog"></i>
                <span>설정</span>
            </a>
            
            <div class="nav-divider"></div>
            
            <a href="../index.html" class="nav-item">
                <i class="fas fa-home"></i>
                <span>사이트로 이동</span>
            </a>
            <a href="#" class="nav-item" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>로그아웃</span>
            </a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
        <!-- Top Bar -->
        <header class="admin-topbar">
            <div class="topbar-left">
                <h1 class="page-title">환불 관리</h1>
                <p class="page-subtitle">환불 신청 내역을 처리하세요</p>
            </div>
            <div class="topbar-right">
                <button class="topbar-btn" onclick="exportRefundData()">
                    <i class="fas fa-download"></i>
                    데이터 내보내기
                </button>
                <div class="admin-profile">
                    <div class="profile-avatar">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <div class="profile-info">
                        <span class="profile-name">관리자</span>
                        <span class="profile-role">Master Admin</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Refunds Content -->
        <div class="refunds-content">
            <!-- Refund Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon pending">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-info">
                        <h3 class="stat-title">처리 대기</h3>
                        <p class="stat-value" id="pendingRefundsCount">로딩 중...</p>
                        <p class="stat-change warning">
                            <i class="fas fa-exclamation-circle"></i>
                            즉시 처리 필요
                        </p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon approved">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-info">
                        <h3 class="stat-title">승인됨</h3>
                        <p class="stat-value" id="approvedRefundsCount">로딩 중...</p>
                        <p class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            이번 달
                        </p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon rejected">
                        <i class="fas fa-times-circle"></i>
                    </div>
                    <div class="stat-info">
                        <h3 class="stat-title">거부됨</h3>
                        <p class="stat-value" id="rejectedRefundsCount">로딩 중...</p>
                        <p class="stat-change neutral">
                            <i class="fas fa-minus"></i>
                            이번 달
                        </p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon revenue">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="stat-info">
                        <h3 class="stat-title">환불 총액</h3>
                        <p class="stat-value" id="totalRefundAmount">로딩 중...</p>
                        <p class="stat-change neutral">
                            <i class="fas fa-info-circle"></i>
                            이번 달
                        </p>
                    </div>
                </div>
            </div>

            <!-- Filter & Search -->
            <div class="filter-section">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="refundSearch" placeholder="주문번호, 사용자명으로 검색..." onkeyup="searchRefunds()">
                </div>
                <div class="filter-group">
                    <select id="statusFilter" onchange="filterRefunds()">
                        <option value="">전체 상태</option>
                        <option value="pending">처리 대기</option>
                        <option value="approved">승인</option>
                        <option value="rejected">거부</option>
                        <option value="completed">완료</option>
                    </select>
                    <select id="dateFilter" onchange="filterRefunds()">
                        <option value="7">최근 일주일</option>
                        <option value="30" selected>최근 한 달</option>
                        <option value="90">최근 분기</option>
                        <option value="365">최근 일 년</option>
                    </select>
                    <button class="filter-btn" onclick="resetFilters()">
                        <i class="fas fa-redo"></i>
                        필터 초기화
                    </button>
                </div>
            </div>

            <!-- Refunds Table -->
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>환불 ID</th>
                            <th>주문번호</th>
                            <th>사용자</th>
                            <th>상품명</th>
                            <th>결제금액</th>
                            <th>환불금액</th>
                            <th>신청일</th>
                            <th>사유</th>
                            <th>상태</th>
                            <th>작업</th>
                        </tr>
                    </thead>
                    <tbody id="refundsTableBody">
                        <!-- Refunds will be loaded here -->
                        <tr>
                            <td colspan="10" class="table-loading">
                                <i class="fas fa-spinner fa-spin"></i>
                                환불 신청 내역을 불러오는 중...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="pagination">
                <button class="page-btn" onclick="previousPage()" id="prevBtn">
                    <i class="fas fa-chevron-left"></i>
                    이전
                </button>
                <div class="page-numbers" id="pageNumbers">
                    <!-- Page numbers will be loaded here -->
                </div>
                <button class="page-btn" onclick="nextPage()" id="nextBtn">
                    다음
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </main>

    <!-- Refund Detail Modal -->
    <div id="refundDetailModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>환불 신청 상세</h2>
                <button class="modal-close" onclick="closeRefundDetailModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="refundDetailBody">
                <!-- Refund details will be loaded here -->
            </div>
            <div class="modal-footer" id="refundDetailActions">
                <!-- Action buttons will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Approve Refund Modal -->
    <div id="approveRefundModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>환불 승인</h2>
                <button class="modal-close" onclick="closeApproveModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="warning-box">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>환불을 승인하시겠습니까? 이 작업은 되돌릴 수 없습니다.</p>
                </div>
                <form id="approveRefundForm" onsubmit="approveRefund(event)">
                    <div class="form-group">
                        <label>환불 금액 확인</label>
                        <input type="text" id="approveRefundAmount" readonly>
                    </div>
                    <div class="form-group">
                        <label>관리자 메모 (선택)</label>
                        <textarea id="approveRefundMemo" rows="3" placeholder="승인 사유나 참고사항을 입력하세요"></textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-cancel" onclick="closeApproveModal()">취소</button>
                        <button type="submit" class="btn-submit success">승인</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Reject Refund Modal -->
    <div id="rejectRefundModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>환불 거부</h2>
                <button class="modal-close" onclick="closeRejectModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="warning-box danger">
                    <i class="fas fa-ban"></i>
                    <p>환불을 거부하시겠습니까? 거부 사유를 반드시 입력해주세요.</p>
                </div>
                <form id="rejectRefundForm" onsubmit="rejectRefund(event)">
                    <div class="form-group">
                        <label>거부 사유 <span class="required">*</span></label>
                        <select id="rejectReason" required>
                            <option value="">사유를 선택하세요</option>
                            <option value="already_used">서비스 이미 사용됨</option>
                            <option value="invalid_request">환불 조건 미충족</option>
                            <option value="duplicate">중복 신청</option>
                            <option value="expired">환불 기간 경과</option>
                            <option value="other">기타</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>상세 사유 <span class="required">*</span></label>
                        <textarea id="rejectReasonDetail" rows="4" placeholder="사용자에게 전달될 거부 사유를 자세히 입력해주세요" required></textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-cancel" onclick="closeRejectModal()">취소</button>
                        <button type="submit" class="btn-submit danger">거부</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin JS -->
    <script src="js/admin.js"></script>
    <script src="js/refunds.js"></script>
</body>
</html>
